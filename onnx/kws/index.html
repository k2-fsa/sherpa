<!-- see https://stackoverflow.com/questions/2454577/sphinx-restructuredtext-show-hide-code-snippets -->
<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Keyword spotting &mdash; sherpa 1.3 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/user.define.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Punctuation" href="../punctuation/index.html" />
    <link rel="prev" title="Hotwords (Contextual biasing)" href="../hotwords/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> sherpa
          </a>
              <div class="version">
                1.3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pdf.html">Download pdf</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../social-groups.html">Social groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../huggingface/index.html">Run Next-gen Kaldi in your browser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pretrained-models.html">Pre-trained models</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">k2-fsa/sherpa</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../sherpa/index.html">sherpa</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">k2-fsa/sherpa-ncnn</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ncnn/index.html">sherpa-ncnn</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">k2-fsa/sherpa-onnx</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">sherpa-onnx</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/index.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faqs/index.html">Frequently Asked Question (FAQs)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python/index.html">Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c-api/index.html">C API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../java-api/index.html">Java API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javascript-api/index.html">Javascript API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kotlin-api/index.html">Kotlin API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../swift-api/index.html">Swift API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../go-api/index.html">Go API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../csharp-api/index.html">C# API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pascal-api/index.html">Pascal API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lazarus/index.html">Lazarus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wasm/index.html">WebAssembly</a></li>
<li class="toctree-l2"><a class="reference internal" href="../android/index.html">Android</a></li>
<li class="toctree-l2"><a class="reference internal" href="../harmony-os/index.html">HarmonyOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ios/index.html">iOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../flutter/index.html">Flutter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../websocket/index.html">WebSocket</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hotwords/index.html">Hotwords (Contextual biasing)</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Keyword spotting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#what-is-open-vocabulary-keyword-spotting">What is open vocabulary keyword spotting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#decoder-for-open-vocabulary-keyword-spotting">Decoder for open vocabulary keyword spotting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#keywords-file">Keywords file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-use-keyword-spotting-in-sherpa-onnx">How to use keyword spotting in sherpa-onnx</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#command-line-tool">command-line tool</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#android-application">Android application</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pretrained-models">Pretrained models</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../punctuation/index.html">Punctuation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../audio-tagging/index.html">Audio tagging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spoken-language-identification/index.html">Spoken language identification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vad/index.html">VAD</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pretrained_models/index.html">Pre-trained models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../moonshine/index.html">Moonshine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sense-voice/index.html">SenseVoice</a></li>
<li class="toctree-l2"><a class="reference internal" href="../paraformer/index.html">Paraformer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nemo/index.html">NeMo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../FireRedAsr/index.html">FireRedAsr</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Dolphin/index.html">Dolphin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../homophone-replacer/index.html">拼音词组匹配替换</a></li>
<li class="toctree-l2"><a class="reference internal" href="../speaker-diarization/index.html">Speaker Diarization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../speaker-identification/index.html">Speaker Identification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../speech-enhancment/index.html">Speech enhancement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../source-separation/index.html">Source separation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rknn/index.html">rknn</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ascend/index.html">Ascend NPU (昇腾 NPU)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tts/index.html">Text-to-speech (TTS)</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Triton</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../triton/overview.html">Triton</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">sherpa</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">sherpa-onnx</a> &raquo;</li>
      <li>Keyword spotting</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/k2-fsa/sherpa/blob/master/docs/source/onnx/kws/index.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="keyword-spotting">
<span id="sherpa-onnx-keyword-spotting"></span><h1>Keyword spotting<a class="headerlink" href="#keyword-spotting" title="Permalink to this heading"></a></h1>
<p>In this section, we describe how we implement the open vocabulary keyword spotting (aka customized keyword spotting)
feature and how to use it in <a class="reference external" href="https://github.com/k2-fsa/sherpa-onnx">sherpa-onnx</a>.</p>
<section id="what-is-open-vocabulary-keyword-spotting">
<h2>What is open vocabulary keyword spotting<a class="headerlink" href="#what-is-open-vocabulary-keyword-spotting" title="Permalink to this heading"></a></h2>
<p>Basically, an open vocabulary keyword spotting system is just like a tiny ASR system, but it can only decode words/phrases
in the given keywords. For example, if the given keyword is <code class="docutils literal notranslate"><span class="pre">HELLO</span> <span class="pre">WORLD</span></code>, then the decoded result should be either
<code class="docutils literal notranslate"><span class="pre">HELLO</span> <span class="pre">WORLD</span></code> or empty. As for open vocabulary (or customized), it means you can specify any keywords without re-training
the model. For building a conventional keyword spotting systems, people need to prepare a lot of audio-text pairs for the selected keywords
and the trained model can only be used to detect those selected keywords.
While an open vocabulary keyword spotting system allows people using one system to detect different keywords, even the keywords
might not be in the training data.</p>
</section>
<section id="decoder-for-open-vocabulary-keyword-spotting">
<h2>Decoder for open vocabulary keyword spotting<a class="headerlink" href="#decoder-for-open-vocabulary-keyword-spotting" title="Permalink to this heading"></a></h2>
<p>For now, we only implement a beam search decoder to make the system only trigger the given keywords (i.e. the model itself is actually a tiny ASR).
To make it is able to balance between the <code class="docutils literal notranslate"><span class="pre">trigged</span> <span class="pre">rate</span></code> and <code class="docutils literal notranslate"><span class="pre">false</span> <span class="pre">alarm</span></code>, we introduce two parameters for each keyword, <code class="docutils literal notranslate"><span class="pre">boosting</span> <span class="pre">score</span></code>
and <code class="docutils literal notranslate"><span class="pre">trigger</span> <span class="pre">threshold</span></code>.  The <code class="docutils literal notranslate"><span class="pre">boosting</span> <span class="pre">score</span></code> works like the hotwords recognition, it help the paths containing keywords to survive beam
search, the larger this score is the easier the corresponding keyword will be triggered, read <a class="reference internal" href="../hotwords/index.html#sherpa-onnx-hotwords"><span class="std std-ref">Hotwords (Contextual biasing)</span></a> for more details.
The <code class="docutils literal notranslate"><span class="pre">trigger</span> <span class="pre">threshold</span></code> defines the minimum acoustic probability of decoded sequences (token sequences) that can be triggered, it is a float
value between 0 to 1, the lower this threshold is the easier the corresponding keyword will be triggered.</p>
</section>
<section id="keywords-file">
<h2>Keywords file<a class="headerlink" href="#keywords-file" title="Permalink to this heading"></a></h2>
<p>The input keywords looks like (the keywords are <code class="docutils literal notranslate"><span class="pre">HELLO</span> <span class="pre">WORLD</span></code>, <code class="docutils literal notranslate"><span class="pre">HI</span> <span class="pre">GOOGLE</span></code> and <code class="docutils literal notranslate"><span class="pre">HEY</span> <span class="pre">SIRI</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>▁HE LL O ▁WORLD :1.5 #0.35
▁HI ▁GO O G LE :1.0 #0.25
▁HE Y ▁S I RI
</pre></div>
</div>
<p>Each line contains a keyword, the first several tokens (separated by spaces) are encoded tokens of the keyword, the item starts with <code class="docutils literal notranslate"><span class="pre">:</span></code> is the <code class="docutils literal notranslate"><span class="pre">boosting</span> <span class="pre">score</span></code> and the item starts with <code class="docutils literal notranslate"><span class="pre">#</span></code> is the <code class="docutils literal notranslate"><span class="pre">trigger</span> <span class="pre">threshold</span></code>. Note: No spaces between <code class="docutils literal notranslate"><span class="pre">:</span></code> (or <code class="docutils literal notranslate"><span class="pre">#</span></code>) and the float value.</p>
<p>To get the tokens you need to use the command line tool in <a class="reference external" href="https://github.com/k2-fsa/sherpa-onnx">sherpa-onnx</a> to convert the original keywords, you can see the
usage as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Note: You need to run pip install sherpa-onnx to get the commandline tool: sherpa-onnx-cli


sherpa-onnx-cli text2token --help
Usage: sherpa-onnx-cli text2token [OPTIONS] INPUT OUTPUT

Options:

  --text TEXT         Path to the input texts. Each line in the texts contains the original phrase, it might also contain some extra items,
                      for example, the boosting score (startting with :), the triggering threshold
                      (startting with #, only used in keyword spotting task) and the original phrase (startting with @).
                      Note: extra items will be kept in the output.

                      example input 1 (tokens_type = ppinyin):
                          小爱同学 :2.0 #0.6 @小爱同学
                          你好问问 :3.5 @你好问问
                          小艺小艺 #0.6 @小艺小艺
                      example output 1:
                          x iǎo ài tóng x ué :2.0 #0.6 @小爱同学
                          n ǐ h ǎo w èn w èn :3.5 @你好问问
                          x iǎo y ì x iǎo y ì #0.6 @小艺小艺

                      example input 2 (tokens_type = bpe):
                          HELLO WORLD :1.5 #0.4
                          HI GOOGLE :2.0 #0.8
                          HEY SIRI #0.35
                      example output 2:
                          ▁HE LL O ▁WORLD :1.5 #0.4
                          ▁HI ▁GO O G LE :2.0 #0.8
                          ▁HE Y ▁S I RI #0.35

  --tokens TEXT       The path to tokens.txt.
  --tokens-type TEXT  The type of modeling units, should be cjkchar, bpe, cjkchar+bpe, fpinyin or ppinyin.
                      fpinyin means full pinyin, each cjkchar has a pinyin(with tone). ppinyin
                      means partial pinyin, it splits pinyin into initial and final,
  --bpe-model TEXT    The path to bpe.model. Only required when tokens-type is bpe or cjkchar+bpe.
  --help              Show this message and exit.
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the tokens-type is <code class="docutils literal notranslate"><span class="pre">fpinyin</span></code> or <code class="docutils literal notranslate"><span class="pre">ppinyin</span></code>, you MUST provide the original keyword (starting with <code class="docutils literal notranslate"><span class="pre">&#64;</span></code>).</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you install sherpa-onnx from sources (i.e. not by pip), you can use the
<a class="reference external" href="https://github.com/k2-fsa/sherpa-onnx/blob/master/scripts/text2token.py">alternative script</a>
in <a class="reference external" href="https://github.com/k2-fsa/sherpa-onnx/tree/master/scripts">scripts</a>,
the usage is almost the same as the command
line tool, read the help information by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="n">scripts</span><span class="o">/</span><span class="n">text2token</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
</div>
</section>
<section id="how-to-use-keyword-spotting-in-sherpa-onnx">
<h2>How to use keyword spotting in sherpa-onnx<a class="headerlink" href="#how-to-use-keyword-spotting-in-sherpa-onnx" title="Permalink to this heading"></a></h2>
<p>Currently, we provide command-line tool and android app for keyword spotting.</p>
<section id="command-line-tool">
<h3>command-line tool<a class="headerlink" href="#command-line-tool" title="Permalink to this heading"></a></h3>
<p>After installing <a class="reference external" href="https://github.com/k2-fsa/sherpa-onnx">sherpa-onnx</a>, type <code class="docutils literal notranslate"><span class="pre">sherpa-onnx-keyword-spotter</span> <span class="pre">--help</span></code> for the help message.</p>
</section>
</section>
<section id="android-application">
<h2>Android application<a class="headerlink" href="#android-application" title="Permalink to this heading"></a></h2>
<p>You can find pre-built Android APKs for keyword spotting at</p>
<blockquote>
<div><p><a class="reference external" href="https://k2-fsa.github.io/sherpa/onnx/kws/apk.html">https://k2-fsa.github.io/sherpa/onnx/kws/apk.html</a></p>
</div></blockquote>
<p>Here is a demo video (Note: It is in Chinese).</p>
<iframe src="//player.bilibili.com/player.html?aid=326175636&bvid=BV1Nw411J7K6&cid=1405110216&p=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" width="600" height="600"> </iframe></section>
<section id="pretrained-models">
<h2>Pretrained models<a class="headerlink" href="#pretrained-models" title="Permalink to this heading"></a></h2>
<p>You can find the pre-trained models in <a class="reference internal" href="pretrained_models/index.html#sherpa-onnx-kws-pre-trained-models"><span class="std std-ref">Pre-trained models</span></a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../hotwords/index.html" class="btn btn-neutral float-left" title="Hotwords (Contextual biasing)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../punctuation/index.html" class="btn btn-neutral float-right" title="Punctuation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2025, sherpa development team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>