<!-- see https://stackoverflow.com/questions/2454577/sphinx-restructuredtext-show-hide-code-snippets -->
<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Endpointing &mdash; sherpa 1.3 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/user.define.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> sherpa
          </a>
              <div class="version">
                1.3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pdf.html">Download pdf</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../social-groups.html">Social groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../huggingface/index.html">Run Next-gen Kaldi in your browser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pretrained-models.html">Pre-trained models</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">k2-fsa/sherpa</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../sherpa/index.html">sherpa</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">k2-fsa/sherpa-ncnn</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ncnn/index.html">sherpa-ncnn</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">k2-fsa/sherpa-onnx</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../onnx/index.html">sherpa-onnx</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Triton</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../triton/overview.html">Triton</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">sherpa</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Endpointing</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/k2-fsa/sherpa/blob/master/docs/source/python/streaming_asr/endpointing.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="endpointing">
<h1>Endpointing<a class="headerlink" href="#endpointing" title="Permalink to this heading"></a></h1>
<p>We borrow the idea of online endpointing from Kaldi.
Please see
<a class="reference external" href="https://kaldi-asr.org/doc/structkaldi_1_1OnlineEndpointRule.html">https://kaldi-asr.org/doc/structkaldi_1_1OnlineEndpointRule.html</a>.</p>
<p>By endpointing in this context we mean “deciding when to stop decoding”, and not
generic speech/silence segmentation. The use-case that we have in mind is some
kind of dialog system where, as more speech data comes in, we decode more
and more, and we have to decide when to stop decoding.</p>
<p>Whenever an endpoint is detected, the server sends the following message
to the client:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">message</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;segment&quot;</span><span class="p">:</span> <span class="n">stream</span><span class="o">.</span><span class="n">segment</span><span class="p">,</span>
    <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">recogntion</span> <span class="n">results</span> <span class="n">of</span> <span class="n">this</span> <span class="n">segment</span><span class="p">,</span>
    <span class="s2">&quot;final&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">stream.segment</span></code> is an integer and it is incremented whenever an endpoint
is detected.</p>
<p>The endpointing rule is a disjunction of conjunctions. The way we have it configured,
it’s an <code class="docutils literal notranslate"><span class="pre">OR</span></code> of <code class="docutils literal notranslate"><span class="pre">3</span></code> rules, and each rule has the following form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(&lt;contains-nonsilence&gt; || !rule.must_contain_nonsilence) &amp;&amp; \
&lt;length-of-trailing-silence&gt; &gt;= rule.min_trailing_silence &amp;&amp; \
&lt;utterance-length&gt; &gt;= rule.min_utterance_length)
</pre></div>
</div>
<dl class="simple">
<dt>where:</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;contains-nonsilence&gt;</span></code> is true if the best traceback contains
any non-blank tokens</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;length-of-trailing-silence&gt;</span></code> is the length in seconds of blank
token at the end of the best traceback (we stop counting when we hit
non-blank tokens)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;utterance-length&gt;</span></code> is the number of seconds of the utterance that we have decoded so far</p></li>
</ul>
</dd>
</dl>
<p>All of these pieces of information are obtained from the best-path traceback from the decoder.
We do this every time we’re finished processing a chunk of data.</p>
<p>For details of the default rules, see the following file:</p>
<p><a class="reference external" href="https://github.com/k2-fsa/sherpa/blob/master/sherpa/python/sherpa/online_endpoint.py">https://github.com/k2-fsa/sherpa/blob/master/sherpa/python/sherpa/online_endpoint.py</a></p>
<p>In summary, we have the following 3 default rules. If any of them is activated,
we say that an endpoint is detected.</p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">Rule</span> <span class="pre">1</span></code>: It times out after 5 seconds of silence, even if we decoded nothing</p>
<p>You can use the following commandline arguments to change it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">endpoint</span><span class="o">.</span><span class="n">rule1</span><span class="o">.</span><span class="n">must</span><span class="o">-</span><span class="n">contain</span><span class="o">-</span><span class="n">nonsilence</span><span class="o">=</span><span class="n">false</span> \
<span class="o">--</span><span class="n">endpoint</span><span class="o">.</span><span class="n">rule1</span><span class="o">.</span><span class="n">min</span><span class="o">-</span><span class="n">trailing</span><span class="o">-</span><span class="n">silence</span><span class="o">=</span><span class="mf">5.0</span> \
<span class="o">--</span><span class="n">endpoint</span><span class="o">.</span><span class="n">rule1</span><span class="o">.</span><span class="n">min</span><span class="o">-</span><span class="n">utterance</span><span class="o">-</span><span class="n">length</span><span class="o">=</span><span class="mf">0.0</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Rule</span> <span class="pre">2</span></code>: It times out after 2.0 seconds of silence after decoding something</p>
<p>You can use the following commandline arguments to change it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">endpoint</span><span class="o">.</span><span class="n">rule2</span><span class="o">.</span><span class="n">must</span><span class="o">-</span><span class="n">contain</span><span class="o">-</span><span class="n">nonsilence</span><span class="o">=</span><span class="n">true</span> \
<span class="o">--</span><span class="n">endpoint</span><span class="o">.</span><span class="n">rule2</span><span class="o">.</span><span class="n">min</span><span class="o">-</span><span class="n">trailing</span><span class="o">-</span><span class="n">silence</span><span class="o">=</span><span class="mf">2.0</span> \
<span class="o">--</span><span class="n">endpoint</span><span class="o">.</span><span class="n">rule2</span><span class="o">.</span><span class="n">min</span><span class="o">-</span><span class="n">utterance</span><span class="o">-</span><span class="n">length</span><span class="o">=</span><span class="mf">0.0</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Rule</span> <span class="pre">3</span></code>: It times out after the utterance is 20 seconds long, regardless of anything else</p>
<p>You can use the following commandline arguments to change it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">endpoint</span><span class="o">.</span><span class="n">rule3</span><span class="o">.</span><span class="n">must</span><span class="o">-</span><span class="n">contain</span><span class="o">-</span><span class="n">nonsilence</span><span class="o">=</span><span class="n">false</span>
<span class="o">--</span><span class="n">endpoint</span><span class="o">.</span><span class="n">rule3</span><span class="o">.</span><span class="n">min</span><span class="o">-</span><span class="n">trailing</span><span class="o">-</span><span class="n">silence</span><span class="o">=</span><span class="mf">0.0</span>
<span class="o">--</span><span class="n">endpoint</span><span class="o">.</span><span class="n">rule3</span><span class="o">.</span><span class="n">min</span><span class="o">-</span><span class="n">utterance</span><span class="o">-</span><span class="n">length</span><span class="o">=</span><span class="mf">20.0</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
<section id="endpointing-demo-english">
<h2>Endpointing Demo (English)<a class="headerlink" href="#endpointing-demo-english" title="Permalink to this heading"></a></h2>
<p>The following video shows an endpointing demo using a pretrained model
on the <a class="reference external" href="https://www.openslr.org/12">LibriSpeech</a> dataset. You can find the usage in
<a class="reference internal" href="lstm/english/server.html#lstm-server-english"><span class="std std-ref">Server</span></a>.</p>
<div class="video_wrapper" style="padding-bottom: 67.500000%; padding-top: 30px; position: relative; width: 120%">
<iframe allowfullscreen="true" src="https://www.youtube.com/embed/4XsTXt_9_SY" style="border: 0; height: 100%; left: 0; position: absolute; top: 0; width: 100%">
</iframe></div></section>
<section id="endpointing-demo-chinese">
<h2>Endpointing Demo (Chinese)<a class="headerlink" href="#endpointing-demo-chinese" title="Permalink to this heading"></a></h2>
<p>The following two videos show endpointing demos using a pretrained model
on the <a class="reference external" href="https://github.com/wenet-e2e/WenetSpeech">WenetSpeech</a> dataset. You can find the usage in
<a class="reference internal" href="lstm/chinese/server.html#lstm-server-chinese"><span class="std std-ref">Server</span></a>.</p>
<section id="short-demo">
<h3>Short Demo<a class="headerlink" href="#short-demo" title="Permalink to this heading"></a></h3>
<div class="video_wrapper" style="padding-bottom: 67.500000%; padding-top: 30px; position: relative; width: 120%">
<iframe allowfullscreen="true" src="https://www.youtube.com/embed/sRQPGMZFun4" style="border: 0; height: 100%; left: 0; position: absolute; top: 0; width: 100%">
</iframe></div></section>
<section id="long-demo">
<h3>Long Demo<a class="headerlink" href="#long-demo" title="Permalink to this heading"></a></h3>
<div class="video_wrapper" style="padding-bottom: 67.500000%; padding-top: 30px; position: relative; width: 120%">
<iframe allowfullscreen="true" src="https://www.youtube.com/embed/LJtPJmX5jpE" style="border: 0; height: 100%; left: 0; position: absolute; top: 0; width: 100%">
</iframe></div></section>
</section>
<section id="endpointing-demo-arabic">
<h2>Endpointing Demo (Arabic)<a class="headerlink" href="#endpointing-demo-arabic" title="Permalink to this heading"></a></h2>
<div class="video_wrapper" style="padding-bottom: 67.500000%; padding-top: 30px; position: relative; width: 120%">
<iframe allowfullscreen="true" src="https://www.youtube.com/embed/t2SlrzgMd_k" style="border: 0; height: 100%; left: 0; position: absolute; top: 0; width: 100%">
</iframe></div></section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2026, sherpa development team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>